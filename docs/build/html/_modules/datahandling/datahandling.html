<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>datahandling.datahandling &#8212; datahandling 3.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for datahandling.datahandling</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datahandling.LeCroy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">_plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">from</span> <span class="nn">bisect</span> <span class="k">import</span> <span class="n">bisect_left</span> <span class="k">as</span> <span class="n">_bisect_left</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">curve_fit</span> <span class="k">as</span> <span class="n">_curve_fit</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> <span class="k">as</span> <span class="nn">_uncertainties</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.axes3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">_animation</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">_sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">_pd</span>
<span class="kn">import</span> <span class="nn">fnmatch</span> <span class="k">as</span> <span class="nn">_fnmatch</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Pool</span> <span class="k">as</span> <span class="n">_Pool</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">cpu_count</span> <span class="k">as</span> <span class="n">_cpu_count</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">minimize</span> <span class="k">as</span> <span class="n">_minimize</span>
<span class="kn">import</span> <span class="nn">warnings</span> <span class="k">as</span> <span class="nn">_warnings</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">hilbert</span> <span class="k">as</span> <span class="n">_hilbert</span>


<div class="viewcode-block" id="load_data"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.load_data">[docs]</a><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">Filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        Filepath : string</span>
<span class="sd">            filepath to the file containing the data used to initialise</span>
<span class="sd">            and create an instance of the DataObject class</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Data : DataObject</span>
<span class="sd">            An instance of the DataObject class contaning the data</span>
<span class="sd">            that you requested to be loaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading data from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Filepath</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">DataObject</span><span class="p">(</span><span class="n">Filepath</span><span class="p">)</span></div>


<div class="viewcode-block" id="multi_load_data"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.multi_load_data">[docs]</a><span class="k">def</span> <span class="nf">multi_load_data</span><span class="p">(</span><span class="n">Channel</span><span class="p">,</span> <span class="n">RunNos</span><span class="p">,</span> <span class="n">RepeatNos</span><span class="p">,</span> <span class="n">directoryPath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lets you load multiple datasets at once.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Channel : int</span>
<span class="sd">        The channel you want to load</span>
<span class="sd">    RunNos : sequence</span>
<span class="sd">        Sequence of run numbers you want to load</span>
<span class="sd">    RepeatNos : sequence</span>
<span class="sd">        Sequence of repeat numbers you want to load</span>
<span class="sd">    directoryPath : string, optional</span>
<span class="sd">        The path to the directory housing the data</span>
<span class="sd">        The default is the current directory</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Data : list</span>
<span class="sd">        A list containing the DataObjects that were loaded. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryPath</span><span class="p">))</span>
    <span class="n">files_CorrectChannel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;CH</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Channel</span><span class="p">)</span> <span class="ow">in</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">files_CorrectChannel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
    <span class="n">files_CorrectRunNo</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">RunNo</span> <span class="ow">in</span> <span class="n">RunNos</span><span class="p">:</span>
        <span class="n">files_match</span> <span class="o">=</span> <span class="n">_fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">files_CorrectChannel</span><span class="p">,</span> <span class="s1">&#39;*RUN*0</span><span class="si">{}</span><span class="s1">_*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RunNo</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">files_match</span><span class="p">:</span>
            <span class="n">files_CorrectRunNo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
    <span class="n">files_CorrectRepeatNo</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">RepeatNo</span> <span class="ow">in</span> <span class="n">RepeatNos</span><span class="p">:</span>
        <span class="n">files_match</span> <span class="o">=</span> <span class="n">_fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">files_CorrectRunNo</span><span class="p">,</span> <span class="s1">&#39;*REPEAT*0</span><span class="si">{}</span><span class="s1">.*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RepeatNo</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">files_match</span><span class="p">:</span>
            <span class="n">files_CorrectRepeatNo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
    <span class="n">cpu_count</span> <span class="o">=</span> <span class="n">_cpu_count</span><span class="p">()</span>
    <span class="n">workerPool</span> <span class="o">=</span> <span class="n">_Pool</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">)</span>
    <span class="c1"># for filepath in files_CorrectRepeatNo:</span>
    <span class="c1">#    print(filepath)</span>
    <span class="c1">#    data.append(load_data(filepath))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">workerPool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">load_data</span><span class="p">,</span> <span class="n">files_CorrectRepeatNo</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="DataObject"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject">[docs]</a><span class="k">class</span> <span class="nc">DataObject</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an object containing data and all it&#39;s properties.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : string</span>
<span class="sd">            filepath to the file containing the data used to initialise</span>
<span class="sd">            this particular instance of the DataObject class</span>
<span class="sd">    filename : string</span>
<span class="sd">            filename of the file containing the data used to initialise</span>
<span class="sd">            this particular instance of the DataObject class</span>
<span class="sd">    waveDescription : dictionary</span>
<span class="sd">            Contains various information about the data as it was collected.</span>
<span class="sd">    time : ndarray</span>
<span class="sd">            Contains the time data in seconds</span>
<span class="sd">    voltage : ndarray</span>
<span class="sd">            Contains the voltage data in Volts</span>
<span class="sd">    SampleFreq : sample frequency used to sample the data (when it was</span>
<span class="sd">            taken by the oscilloscope)</span>
<span class="sd">    freqs : ndarray</span>
<span class="sd">            Contains the frequencies corresponding to the PSD (Pulse Spectral</span>
<span class="sd">            Density)</span>
<span class="sd">    PSD : ndarray</span>
<span class="sd">            Contains the values for the PSD (Pulse Spectral Density) as calculated</span>
<span class="sd">            at each frequency contained in freqs</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : string</span>
<span class="sd">            The filepath to the data file to initialise this object instance.</span>

<span class="sd">        Initialisation - assigns values to the following attributes:</span>
<span class="sd">        - filepath</span>
<span class="sd">        - filename</span>
<span class="sd">        - filedir</span>
<span class="sd">        - time</span>
<span class="sd">        - voltage</span>
<span class="sd">        - freqs</span>
<span class="sd">        - PSD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filedir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_time_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_PSD</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="DataObject.get_time_data"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.get_time_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the time and voltage data and the wave description.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        time : ndarray</span>
<span class="sd">                        array containing the value of time (in seconds) at which the</span>
<span class="sd">                        voltage is sampled</span>
<span class="sd">        voltage : ndarray</span>
<span class="sd">                        array containing the sampled voltages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveDescription</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
            <span class="n">datahandling</span><span class="o">.</span><span class="n">LeCroy</span><span class="o">.</span><span class="n">InterpretWaveform</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleFreq</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveDescription</span><span class="p">[</span><span class="s2">&quot;HORIZ_INTERVAL&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voltage</span></div>

<div class="viewcode-block" id="DataObject.plot_time_data"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.plot_time_data">[docs]</a>    <span class="k">def</span> <span class="nf">plot_time_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeStart</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="n">timeEnd</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot time data against voltage data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeStart : float, optional</span>
<span class="sd">            The time to start plotting from.</span>
<span class="sd">            By default it uses the first time point</span>
<span class="sd">        timeEnd : float, optional</span>
<span class="sd">            The time to finish plotting at.</span>
<span class="sd">            By default it uses the last time point</span>
<span class="sd">        ShowFig : bool, optional</span>
<span class="sd">            If True runs plt.show() before returning figure</span>
<span class="sd">            if False it just returns the figure object.</span>
<span class="sd">            (the default is True, it shows the figure)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">            The figure object created</span>
<span class="sd">        ax : fig.add_subplot(111)</span>
<span class="sd">            The subplot object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timeStart</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
            <span class="n">timeStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">timeEnd</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
            <span class="n">timeEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">StartIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">timeStart</span><span class="p">))</span>
        <span class="n">EndIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">timeEnd</span><span class="p">))</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">StartIndex</span><span class="p">:</span><span class="n">EndIndex</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">[</span><span class="n">StartIndex</span><span class="p">:</span><span class="n">EndIndex</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;voltage (V)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">timeStart</span><span class="p">,</span> <span class="n">timeEnd</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="DataObject.get_PSD"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.get_PSD">[docs]</a>    <span class="k">def</span> <span class="nf">get_PSD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPerSegment</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the pulse spectral density (PSD) from the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        NPerSegment : int, optional</span>
<span class="sd">            Length of each segment used in scipy.welch</span>
<span class="sd">            default = the Number of time points</span>

<span class="sd">        window : str or tuple or array_like, optional</span>
<span class="sd">            Desired window to use. See get_window for a list of windows</span>
<span class="sd">            and required parameters. If window is array_like it will be</span>
<span class="sd">            used directly as the window and its length will be used for</span>
<span class="sd">            nperseg.</span>
<span class="sd">            default = &quot;hann&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        freqs : ndarray</span>
<span class="sd">                Array containing the frequencies at which the PSD has been</span>
<span class="sd">                calculated</span>
<span class="sd">        PSD : ndarray</span>
<span class="sd">                Array containing the value of the PSD at the corresponding</span>
<span class="sd">                frequency value in V**2/Hz</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">NPerSegment</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
            <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">NPerSegment</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e5</span><span class="p">:</span>
                <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="n">e5</span><span class="p">)</span>
        <span class="n">freqs</span><span class="p">,</span> <span class="n">PSD</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleFreq</span><span class="p">,</span>
                                        <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">PSD</span> <span class="o">=</span> <span class="n">PSD</span><span class="p">[</span><span class="n">freqs</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
        <span class="n">freqs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PSD</span> <span class="o">=</span> <span class="n">PSD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD</span></div>

<div class="viewcode-block" id="DataObject.plot_PSD"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.plot_PSD">[docs]</a>    <span class="k">def</span> <span class="nf">plot_PSD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot the pulse spectral density.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlim : array_like, optional</span>
<span class="sd">            The x limits of the plotted PSD [LowerLimit, UpperLimit]</span>
<span class="sd">            Default value is [0, SampleFreq/2]</span>
<span class="sd">        ShowFig : bool, optional</span>
<span class="sd">            If True runs plt.show() before returning figure</span>
<span class="sd">            if False it just returns the figure object.</span>
<span class="sd">            (the default is True, it shows the figure)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">                        The figure object created</span>
<span class="sd">                ax : fig.add_subplot(111)</span>
<span class="sd">                        The subplot object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#        self.get_PSD()</span>
        <span class="k">if</span> <span class="n">xlim</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleFreq</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$S_</span><span class="si">{xx}</span><span class="s2">$ ($v^2/Hz$)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="DataObject.calc_area_under_PSD"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.calc_area_under_PSD">[docs]</a>    <span class="k">def</span> <span class="nf">calc_area_under_PSD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lowerFreq</span><span class="p">,</span> <span class="n">upperFreq</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sums the area under the PSD from lowerFreq to upperFreq.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lowerFreq : float</span>
<span class="sd">            The lower limit of frequency to sum from</span>
<span class="sd">        upperFreq : float</span>
<span class="sd">            The upper limit of frequency to sum to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        AreaUnderPSD : float</span>
<span class="sd">            The area under the PSD from lowerFreq to upperFreq</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Freq_startAreaPSD</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">lowerFreq</span><span class="p">)</span>
        <span class="n">index_startAreaPSD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">==</span> <span class="n">Freq_startAreaPSD</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Freq_endAreaPSD</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">upperFreq</span><span class="p">)</span>
        <span class="n">index_endAreaPSD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">==</span> <span class="n">Freq_endAreaPSD</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">AreaUnderPSD</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">index_startAreaPSD</span><span class="p">:</span> <span class="n">index_endAreaPSD</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">AreaUnderPSD</span></div>

<div class="viewcode-block" id="DataObject.get_fit"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.get_fit">[docs]</a>    <span class="k">def</span> <span class="nf">get_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TrapFreq</span><span class="p">,</span> <span class="n">WidthOfPeakToFit</span><span class="p">,</span> <span class="n">A_Initial</span><span class="o">=</span><span class="mf">0.1e10</span><span class="p">,</span> <span class="n">Gamma_Initial</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">NMovAveToFit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MakeFig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that fits to a peak to the PSD to extract the </span>
<span class="sd">        frequency, A factor and Gamma (damping) factor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        TrapFreq : float</span>
<span class="sd">            The approximate trapping frequency to use initially</span>
<span class="sd">            as the centre of the peak</span>
<span class="sd">        WidthOfPeakToFit : float</span>
<span class="sd">            The width of the peak to be fitted to. This limits the</span>
<span class="sd">            region that the fitting function can see in order to</span>
<span class="sd">            stop it from fitting to the wrong peak</span>
<span class="sd">        A_Initial : float, optional</span>
<span class="sd">            The initial value of the A parameter to use in fitting</span>
<span class="sd">        Gamma_Initial : float, optional</span>
<span class="sd">            The initial value of the Gamma parameter to use in fitting</span>
<span class="sd">        NMovAveToFit : int, optional</span>
<span class="sd">            The number of point of moving average filter to perform</span>
<span class="sd">            before fitting in order to smooth out the peak.</span>
<span class="sd">            defaults to 1.</span>
<span class="sd">        Silent : bool, optional</span>
<span class="sd">            Whether to print any output when running this function</span>
<span class="sd">            defaults to False</span>
<span class="sd">        MakeFig : bool, optional</span>
<span class="sd">            Whether to construct and return the figure object showing</span>
<span class="sd">            the fitting. defaults to True</span>
<span class="sd">        ShowFig : bool, optional</span>
<span class="sd">            Whether to show the figure object when it has been created.</span>
<span class="sd">            defaults to True</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A : uncertainties.ufloat</span>
<span class="sd">            Fitting constant A</span>
<span class="sd">            A = γ**2*Γ_0*(K_b*T_0)/(π*m)</span>
<span class="sd">            where:</span>
<span class="sd">                γ = conversionFactor</span>
<span class="sd">                Γ_0 = Damping factor due to environment</span>
<span class="sd">                π = pi</span>
<span class="sd">        Ftrap : uncertainties.ufloat</span>
<span class="sd">            The trapping frequency in the z axis (in angular frequency)</span>
<span class="sd">        Gamma : uncertainties.ufloat</span>
<span class="sd">            The damping factor Gamma = Γ = Γ_0 + δΓ</span>
<span class="sd">            where:</span>
<span class="sd">                Γ_0 = Damping factor due to environment</span>
<span class="sd">                δΓ = extra damping due to feedback or other effects</span>
<span class="sd">        fig : matplotlib.figure.Figure object</span>
<span class="sd">            figure object containing the plot</span>
<span class="sd">        ax : matplotlib.axes.Axes object</span>
<span class="sd">            axes with the data plotted of the:</span>
<span class="sd">                - initial data</span>
<span class="sd">                - smoothed data</span>
<span class="sd">                - initial fit</span>
<span class="sd">                - final fit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">MakeFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">Params</span><span class="p">,</span> <span class="n">ParamsErr</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">fit_PSD</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">WidthOfPeakToFit</span><span class="p">,</span> <span class="n">NMovAveToFit</span><span class="p">,</span> <span class="n">TrapFreq</span><span class="p">,</span> <span class="n">A_Initial</span><span class="p">,</span> <span class="n">Gamma_Initial</span><span class="p">,</span> <span class="n">MakeFig</span><span class="o">=</span><span class="n">MakeFig</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="n">ShowFig</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Params</span><span class="p">,</span> <span class="n">ParamsErr</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fit_PSD</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">WidthOfPeakToFit</span><span class="p">,</span> <span class="n">NMovAveToFit</span><span class="p">,</span> <span class="n">TrapFreq</span><span class="p">,</span> <span class="n">A_Initial</span><span class="p">,</span> <span class="n">Gamma_Initial</span><span class="p">,</span> <span class="n">MakeFig</span><span class="o">=</span><span class="n">MakeFig</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="n">ShowFig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Silent</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A: </span><span class="si">{}</span><span class="s2"> +- </span><span class="si">{}</span><span class="s2">% &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">ParamsErr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">Params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Trap Frequency: </span><span class="si">{}</span><span class="s2"> +- </span><span class="si">{}</span><span class="s2">% &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ParamsErr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">Params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Big Gamma: </span><span class="si">{}</span><span class="s2"> +- </span><span class="si">{}</span><span class="s2">% &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ParamsErr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">Params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">Params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ParamsErr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftrap</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">Params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ParamsErr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">Params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ParamsErr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">MakeFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftrap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftrap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataObject.get_fit_from_peak"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.get_fit_from_peak">[docs]</a>    <span class="k">def</span> <span class="nf">get_fit_from_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lowerLimit</span><span class="p">,</span> <span class="n">upperLimit</span><span class="p">,</span> <span class="n">NumPointsSmoothing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds an approximate values for the peaks central frequency, height, </span>
<span class="sd">        and FWHM by looking for the heighest peak in the frequncy range defined </span>
<span class="sd">        by the imput arguments. It then uses the central frequncy as the trapping </span>
<span class="sd">        frequency, peak height to an approximate A value and the FWHM to an approximate</span>
<span class="sd">        Gamma (damping) value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lowerLimit : float</span>
<span class="sd">            The lower frequency limit of the range in which it looks for a peak</span>
<span class="sd">        upperLimit : float</span>
<span class="sd">            The higher frequency limit of the range in which it looks for a peak</span>
<span class="sd">        NumPointsSmoothing : float</span>
<span class="sd">            The number of points of moving-average smoothing it applies before fitting the </span>
<span class="sd">            peak.</span>
<span class="sd">        Silent : bool, optional</span>
<span class="sd">            Whether it prints the values fitted or is silent.</span>
<span class="sd">        ShowFig : bool, optional</span>
<span class="sd">            Whether it makes and shows the figure object or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Ftraps : ufloat</span>
<span class="sd">            Trapping frequency</span>
<span class="sd">        A : ufloat</span>
<span class="sd">            A parameter</span>
<span class="sd">        Gamma : ufloat</span>
<span class="sd">            Gamma, the damping parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lowerIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">lowerLimit</span><span class="p">))</span>
        <span class="n">upperIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">upperLimit</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">lowerIndex</span> <span class="o">==</span> <span class="n">upperIndex</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;range is too small, returning NaN&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span>

        <span class="n">MaxPSD</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">lowerIndex</span><span class="p">:</span><span class="n">upperIndex</span><span class="p">])</span>

        <span class="n">CentralFreq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">MaxPSD</span><span class="p">)]</span>
        <span class="n">centralIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">CentralFreq</span><span class="p">)</span>

        <span class="n">approx_A</span> <span class="o">=</span> <span class="n">MaxPSD</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e16</span>  <span class="c1"># 1e16 was calibrated for a number of saves to be approximately the correct conversion factor between the height of the PSD and the A factor in the fitting</span>

        <span class="n">MinPSD</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">lowerIndex</span><span class="p">:</span><span class="n">upperIndex</span><span class="p">])</span>

        <span class="c1"># need to get this on log scale</span>
        <span class="n">HalfMax</span> <span class="o">=</span> <span class="n">MinPSD</span> <span class="o">+</span> <span class="p">(</span><span class="n">MaxPSD</span> <span class="o">-</span> <span class="n">MinPSD</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">LeftSideOfPeakIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                <span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">lowerIndex</span><span class="p">:</span><span class="n">centralIndex</span><span class="p">],</span> <span class="n">HalfMax</span><span class="p">))</span>
            <span class="n">LeftSideOfPeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">LeftSideOfPeakIndex</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;range is too small, returning NaN&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">RightSideOfPeakIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                <span class="n">take_closest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">centralIndex</span><span class="p">:</span><span class="n">upperIndex</span><span class="p">],</span> <span class="n">HalfMax</span><span class="p">))</span>
            <span class="n">RightSideOfPeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">RightSideOfPeakIndex</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;range is too small, returning NaN&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span>

        <span class="n">FWHM</span> <span class="o">=</span> <span class="n">RightSideOfPeak</span> <span class="o">-</span> <span class="n">LeftSideOfPeak</span>

        <span class="n">approx_Gamma</span> <span class="o">=</span> <span class="n">FWHM</span><span class="o">/</span><span class="mi">4</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_fit</span><span class="p">(</span><span class="n">CentralFreq</span><span class="p">,</span> <span class="p">(</span><span class="n">upperLimit</span><span class="o">-</span><span class="n">lowerLimit</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
                         <span class="n">A_Initial</span><span class="o">=</span><span class="n">approx_A</span><span class="p">,</span> <span class="n">Gamma_Initial</span><span class="o">=</span><span class="n">approx_Gamma</span><span class="p">,</span> <span class="n">Silent</span><span class="o">=</span><span class="n">Silent</span><span class="p">,</span> <span class="n">MakeFig</span><span class="o">=</span><span class="n">ShowFig</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="n">ShowFig</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> 
            <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;range is too small to fit, returning NaN&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span>
        <span class="n">FTrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftrap</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span>
        <span class="n">Gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span>

        <span class="n">omegaArray</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">LeftSideOfPeakIndex</span><span class="p">:</span><span class="n">RightSideOfPeakIndex</span><span class="p">]</span>
        <span class="n">PSDArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">LeftSideOfPeakIndex</span><span class="p">:</span><span class="n">RightSideOfPeakIndex</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">FTrap</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Gamma</span></div>

<div class="viewcode-block" id="DataObject.get_fit_auto"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.get_fit_auto">[docs]</a>    <span class="k">def</span> <span class="nf">get_fit_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CentralFreq</span><span class="p">,</span> <span class="n">MaxWidth</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span> <span class="n">MinWidth</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">WidthIntervals</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries a range of regions to search for peaks and runs the one with the least error</span>
<span class="sd">        and returns the parameters with the least errors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        CentralFreq : float</span>
<span class="sd">            The central frequency to use for the fittings.</span>
<span class="sd">        MaxWidth : float, optional</span>
<span class="sd">            The maximum bandwidth to use for the fitting of the peaks.</span>
<span class="sd">        MinWidth : float, optional</span>
<span class="sd">            The minimum bandwidth to use for the fitting of the peaks.</span>
<span class="sd">        WidthIntervals : float, optional</span>
<span class="sd">            The intervals to use in going between the MaxWidth and MinWidth.</span>
<span class="sd">        ShowFig : bool, optional</span>
<span class="sd">            Whether to plot and show the final (best) fitting or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Ftraps : ufloat</span>
<span class="sd">            Trapping frequency</span>
<span class="sd">        A : ufloat</span>
<span class="sd">            A parameter</span>
<span class="sd">        Gamma : ufloat</span>
<span class="sd">            Gamma, the damping parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MinTotalSumSquaredError</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">infty</span>
        <span class="k">for</span> <span class="n">Width</span> <span class="ow">in</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">MaxWidth</span><span class="p">,</span> <span class="n">MinWidth</span> <span class="o">-</span> <span class="n">WidthIntervals</span><span class="p">,</span> <span class="o">-</span><span class="n">WidthIntervals</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Ftrap</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_from_peak</span><span class="p">(</span>
                    <span class="n">CentralFreq</span> <span class="o">-</span> <span class="n">Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CentralFreq</span> <span class="o">+</span> <span class="n">Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find good fit with width </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">Width</span><span class="p">),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
                <span class="n">Ftrap</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">Gamma</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">TotalSumSquaredError</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">A</span><span class="o">.</span><span class="n">std_dev</span> <span class="o">/</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Gamma</span><span class="o">.</span><span class="n">std_dev</span> <span class="o">/</span> <span class="n">Gamma</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ftrap</span><span class="o">.</span><span class="n">std_dev</span> <span class="o">/</span> <span class="n">Ftrap</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="c1">#print(&quot;totalError: {}&quot;.format(TotalSumSquaredError))</span>
            <span class="k">if</span> <span class="n">TotalSumSquaredError</span> <span class="o">&lt;</span> <span class="n">MinTotalSumSquaredError</span><span class="p">:</span>
                <span class="n">MinTotalSumSquaredError</span> <span class="o">=</span> <span class="n">TotalSumSquaredError</span>
                <span class="n">BestWidth</span> <span class="o">=</span> <span class="n">Width</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found best&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_from_peak</span><span class="p">(</span><span class="n">CentralFreq</span> <span class="o">-</span> <span class="n">BestWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="n">CentralFreq</span> <span class="o">+</span> <span class="n">BestWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="n">ShowFig</span><span class="p">)</span>
        <span class="n">FTrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftrap</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span>
        <span class="n">Gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span>
        <span class="k">return</span> <span class="n">FTrap</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Gamma</span></div>

<div class="viewcode-block" id="DataObject.extract_parameters"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.extract_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">extract_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P_mbar</span><span class="p">,</span> <span class="n">P_Error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the Radius  mass and Conversion factor for a particle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        P_mbar : float </span>
<span class="sd">            The pressure in mbar when the data was taken.</span>
<span class="sd">        P_Error : float</span>
<span class="sd">            The error in the pressure value (as a decimal e.g. 15% = 0.15)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Radius : uncertainties.ufloat</span>
<span class="sd">            The radius of the particle in m</span>
<span class="sd">        Mass : uncertainties.ufloat</span>
<span class="sd">            The mass of the particle in kg</span>
<span class="sd">        ConvFactor : uncertainties.ufloat</span>
<span class="sd">            The conversion factor between volts/m</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">[</span><span class="n">R</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">ConvFactor</span><span class="p">],</span> <span class="p">[</span><span class="n">RErr</span><span class="p">,</span> <span class="n">MErr</span><span class="p">,</span> <span class="n">ConvFactorErr</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">extract_parameters</span><span class="p">(</span><span class="n">P_mbar</span><span class="p">,</span> <span class="n">P_Error</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">std_dev</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span><span class="o">.</span><span class="n">std_dev</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Radius</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">RErr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mass</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">MErr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConvFactor</span> <span class="o">=</span> <span class="n">_uncertainties</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="n">ConvFactor</span><span class="p">,</span> <span class="n">ConvFactorErr</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvFactor</span></div>

<div class="viewcode-block" id="DataObject.extract_ZXY_motion"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.extract_ZXY_motion">[docs]</a>    <span class="k">def</span> <span class="nf">extract_ZXY_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ApproxZXYFreqs</span><span class="p">,</span> <span class="n">uncertaintyInFreqs</span><span class="p">,</span> <span class="n">ZXYPeakWidths</span><span class="p">,</span> <span class="n">subSampleFraction</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the x, y and z signals (in volts) from the voltage signal. Does this by finding the highest peaks in the signal about the approximate frequencies, using the uncertaintyinfreqs parameter as the width it searches. It then uses the ZXYPeakWidths to construct bandpass IIR filters for each frequency and filtering them. If too high a sample frequency has been used to collect the data scipy may not be able to construct a filter good enough, in this case increasing the subSampleFraction may be nessesary.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ApproxZXYFreqs : array_like</span>
<span class="sd">            A sequency containing 3 elements, the approximate </span>
<span class="sd">            z, x and y frequency respectively.</span>
<span class="sd">        uncertaintyInFreqs : array_like</span>
<span class="sd">            A sequency containing 3 elements, the uncertainty in the</span>
<span class="sd">            z, x and y frequency respectively.</span>
<span class="sd">        ZXYPeakWidths : array_like</span>
<span class="sd">            A sequency containing 3 elements, the widths of the</span>
<span class="sd">            z, x and y frequency peaks respectively.</span>
<span class="sd">        subSampleFraction : int, optional</span>
<span class="sd">            How much to sub-sample the data by before filtering,</span>
<span class="sd">            effectively reducing the sample frequency by this </span>
<span class="sd">            fraction.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self.zVolts : ndarray</span>
<span class="sd">            The z signal in volts extracted by bandpass IIR filtering</span>
<span class="sd">        self.xVolts : ndarray</span>
<span class="sd">            The x signal in volts extracted by bandpass IIR filtering</span>
<span class="sd">        self.yVolts : ndarray</span>
<span class="sd">            The y signal in volts extracted by bandpass IIR filtering        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">]</span> <span class="o">=</span> <span class="n">ApproxZXYFreqs</span>
        <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span> <span class="o">=</span> <span class="n">get_ZXY_freqs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">uncertaintyInFreqs</span><span class="p">)</span>
        <span class="c1">#print(zf, xf, yf)</span>
        <span class="p">[</span><span class="n">zwidth</span><span class="p">,</span> <span class="n">xwidth</span><span class="p">,</span> <span class="n">ywidth</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZXYPeakWidths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zVolts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xVolts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yVolts</span> <span class="o">=</span> <span class="n">get_ZXY_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">subSampleFraction</span><span class="p">,</span> <span class="n">zwidth</span><span class="p">,</span> <span class="n">xwidth</span><span class="p">,</span> <span class="n">ywidth</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zVolts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xVolts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yVolts</span></div>

<div class="viewcode-block" id="DataObject.plot_phase_space"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.DataObject.plot_phase_space">[docs]</a>    <span class="k">def</span> <span class="nf">plot_phase_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="o">=</span><span class="mi">80000</span><span class="p">,</span> <span class="n">yf</span><span class="o">=</span><span class="mi">120000</span><span class="p">,</span> <span class="n">FractionOfSampleFreq</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zwidth</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">xwidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">ywidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        author: Markus Rademacher</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Z</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Time</span> <span class="o">=</span> <span class="n">get_ZXY_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">FractionOfSampleFreq</span><span class="p">,</span> <span class="n">zwidth</span><span class="p">,</span> <span class="n">xwidth</span><span class="p">,</span> <span class="n">ywidth</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">conv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvFactor</span><span class="o">.</span><span class="n">n</span>
        <span class="n">ZArray</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">/</span> <span class="n">conv</span>
        <span class="n">ZVArray</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ZArray</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SampleFreq</span> <span class="o">/</span> <span class="n">FractionOfSampleFreq</span><span class="p">)</span>
        <span class="n">VarZ</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ZArray</span><span class="p">)</span>
        <span class="n">VarZV</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ZVArray</span><span class="p">)</span>
        <span class="n">MaxZ</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ZArray</span><span class="p">)</span>
        <span class="n">MaxZV</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ZVArray</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MaxZ</span> <span class="o">&gt;</span> <span class="n">MaxZV</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">zf</span><span class="p">):</span>
            <span class="n">_plotlimit</span> <span class="o">=</span> <span class="n">MaxZ</span> <span class="o">*</span> <span class="mf">1.1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_plotlimit</span> <span class="o">=</span> <span class="n">MaxZV</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">zf</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.1</span>

        <span class="n">JP1</span> <span class="o">=</span> <span class="n">_sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">_pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ZArray</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;$z$(m) </span><span class="se">\n</span><span class="s2"> filepath=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)),</span> <span class="n">_pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">ZVArray</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">zf</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;$v_z$/$\omega$(m)&quot;</span><span class="p">),</span> <span class="n">stat_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">_plotlimit</span><span class="p">,</span> <span class="n">_plotlimit</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">_plotlimit</span><span class="p">,</span> <span class="n">_plotlimit</span><span class="p">])</span>
        <span class="n">JP1</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ZArray</span><span class="p">),</span> <span class="n">MaxZV</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">zf</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span>
                          <span class="s2">r&quot;$\sigma_z=$ </span><span class="si">%.2E</span><span class="s2">m, $\sigma_v=$ </span><span class="si">%.2E</span><span class="s2">m&quot;</span> <span class="o">%</span> <span class="p">(</span>
                              <span class="n">VarZ</span><span class="p">,</span> <span class="n">VarZV</span><span class="p">),</span>
                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">JP1</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ZArray</span><span class="p">),</span> <span class="n">MaxZV</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">zf</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">,</span>
                          <span class="s2">&quot;filepath=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">),</span>
                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">VarZ</span><span class="p">,</span> <span class="n">VarZV</span><span class="p">,</span> <span class="n">JP1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mass</span></div></div>


<div class="viewcode-block" id="calc_temp"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.calc_temp">[docs]</a><span class="k">def</span> <span class="nf">calc_temp</span><span class="p">(</span><span class="n">Data_ref</span><span class="p">,</span> <span class="n">Data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the temperature of a data set relative to a reference.</span>
<span class="sd">    The reference is assumed to be at 300K.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Data_ref : DataObject</span>
<span class="sd">        Reference data set, assumed to be 300K</span>
<span class="sd">    Data : DataObject</span>
<span class="sd">        Data object to have the temperature calculated for</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    T : uncertainties.ufloat</span>
<span class="sd">        The temperature of the data set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">*</span> <span class="p">((</span><span class="n">Data</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">Data_ref</span><span class="o">.</span><span class="n">Gamma</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Data_ref</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">Data</span><span class="o">.</span><span class="n">Gamma</span><span class="p">))</span>
    <span class="n">Data</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
    <span class="k">return</span> <span class="n">T</span></div>


<div class="viewcode-block" id="fit_curvefit"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.fit_curvefit">[docs]</a><span class="k">def</span> <span class="nf">fit_curvefit</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">datax</span><span class="p">,</span> <span class="n">datay</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits the data to a function using scipy.optimise.curve_fit</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p0 : array_like</span>
<span class="sd">        initial parameters to use for fitting</span>
<span class="sd">    datax : array_like</span>
<span class="sd">        x data to use for fitting</span>
<span class="sd">    datay : array_like</span>
<span class="sd">        y data to use for fitting</span>
<span class="sd">    function : function</span>
<span class="sd">        funcion to be fit to the data</span>
<span class="sd">    kwargs </span>
<span class="sd">        keyword arguments to be passed to scipy.optimise.curve_fit</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pfit_curvefit : array</span>
<span class="sd">        Optimal values for the parameters so that the sum of</span>
<span class="sd">        the squared residuals of f(xdata, *popt) - ydata is minimized</span>
<span class="sd">    perr_curvefit : array</span>
<span class="sd">        One standard deviation errors in the optimal values for</span>
<span class="sd">        the parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pfit</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> \
        <span class="n">_curve_fit</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">datax</span><span class="p">,</span> <span class="n">datay</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>
                   <span class="n">epsfcn</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pfit</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">pcov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
    <span class="n">pfit_curvefit</span> <span class="o">=</span> <span class="n">pfit</span>
    <span class="n">perr_curvefit</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pfit_curvefit</span><span class="p">,</span> <span class="n">perr_curvefit</span></div>


<div class="viewcode-block" id="moving_average"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.moving_average">[docs]</a><span class="k">def</span> <span class="nf">moving_average</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the moving average of an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : array</span>
<span class="sd">        The array to have the moving average taken of</span>
<span class="sd">    n : int</span>
<span class="sd">        The number of points of moving average to take</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    MovingAverageArray : array</span>
<span class="sd">        The n-point moving average of the input array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ret</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">n</span></div>


<div class="viewcode-block" id="take_closest"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.take_closest">[docs]</a><span class="k">def</span> <span class="nf">take_closest</span><span class="p">(</span><span class="n">myList</span><span class="p">,</span> <span class="n">myNumber</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assumes myList is sorted. Returns closest value to myNumber.</span>
<span class="sd">    If two numbers are equally close, return the smallest number.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    myList : array</span>
<span class="sd">        The list in which to find the closest value to myNumber</span>
<span class="sd">    myNumber : float</span>
<span class="sd">        The number to find the closest to in MyList</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    closestValue : float</span>
<span class="sd">        The number closest to myNumber in myList</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">_bisect_left</span><span class="p">(</span><span class="n">myList</span><span class="p">,</span> <span class="n">myNumber</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">myList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">myList</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">myList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">before</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">after</span> <span class="o">=</span> <span class="n">myList</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">after</span> <span class="o">-</span> <span class="n">myNumber</span> <span class="o">&lt;</span> <span class="n">myNumber</span> <span class="o">-</span> <span class="n">before</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">after</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">before</span></div>


<span class="k">def</span> <span class="nf">_PSD_fitting_eqn</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">OmegaTrap</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The value of the fitting equation:</span>
<span class="sd">    A / ((OmegaTrap**2 - omega**2)**2 + (omega * gamma)**2)</span>
<span class="sd">    to be fit to the PSD</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : float</span>
<span class="sd">        Fitting constant A</span>
<span class="sd">        A = γ**2*Γ_0*(K_b*T_0)/(π*m)</span>
<span class="sd">        where:</span>
<span class="sd">            γ = conversionFactor</span>
<span class="sd">            Γ_0 = Damping factor due to environment</span>
<span class="sd">            π = pi</span>
<span class="sd">    OmegaTrap : float</span>
<span class="sd">        The trapping frequency in the axis of interest </span>
<span class="sd">        (in angular frequency)</span>
<span class="sd">    Gamma : float</span>
<span class="sd">        The damping factor Gamma = Γ = Γ_0 + δΓ</span>
<span class="sd">        where:</span>
<span class="sd">            Γ_0 = Damping factor due to environment</span>
<span class="sd">            δΓ = extra damping due to feedback or other effects</span>
<span class="sd">    omega : float</span>
<span class="sd">        The angular frequency to calculate the value of the </span>
<span class="sd">        fitting equation at </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Value : float</span>
<span class="sd">        The value of the fitting equation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">/</span> <span class="p">((</span><span class="n">OmegaTrap</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">omega</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="fit_PSD"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.fit_PSD">[docs]</a><span class="k">def</span> <span class="nf">fit_PSD</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">NMovAve</span><span class="p">,</span> <span class="n">TrapFreqGuess</span><span class="p">,</span> <span class="n">AGuess</span><span class="o">=</span><span class="mf">0.1e10</span><span class="p">,</span> <span class="n">GammaGuess</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">MakeFig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits theory PSD to Data. Assumes highest point of PSD is the</span>
<span class="sd">    trapping frequency.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Data : DataObject</span>
<span class="sd">        data object to be fitted</span>
<span class="sd">    bandwidth : float</span>
<span class="sd">         bandwidth around trapping frequency peak to</span>
<span class="sd">         fit the theory PSD to</span>
<span class="sd">    NMovAve : integer</span>
<span class="sd">         amount of moving averages to take before the fitting</span>
<span class="sd">    TrapFreqGuess : float</span>
<span class="sd">        The approximate trapping frequency to use initially</span>
<span class="sd">        as the centre of the peak</span>
<span class="sd">    AGuess : float, optional</span>
<span class="sd">        The initial value of the A parameter to use in fitting</span>
<span class="sd">    GammaGuess : float, optional</span>
<span class="sd">        The initial value of the Gamma parameter to use in fitting</span>
<span class="sd">    MakeFig : bool, optional</span>
<span class="sd">        Whether to construct and return the figure object showing</span>
<span class="sd">        the fitting. defaults to True</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">        Whether to show the figure object when it has been created.</span>
<span class="sd">        defaults to True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ParamsFit - Fitted parameters:</span>
<span class="sd">        [A, TrappingFrequency, Gamma]</span>
<span class="sd">    ParamsFitErr - Error in fitted parameters:</span>
<span class="sd">        [AErr, TrappingFrequencyErr, GammaErr]</span>
<span class="sd">    fig : matplotlib.figure.Figure object</span>
<span class="sd">        figure object containing the plot</span>
<span class="sd">    ax : matplotlib.axes.Axes object</span>
<span class="sd">        axes with the data plotted of the:</span>
<span class="sd">            - initial data</span>
<span class="sd">            - smoothed data</span>
<span class="sd">            - initial fit</span>
<span class="sd">            - final fit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">AngFreqs</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Data</span><span class="o">.</span><span class="n">freqs</span>
    <span class="n">Angbandwidth</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">bandwidth</span>
    <span class="n">AngTrapFreqGuess</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">TrapFreqGuess</span>

    <span class="n">ClosestToAngTrapFreqGuess</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">AngFreqs</span><span class="p">,</span> <span class="n">AngTrapFreqGuess</span><span class="p">)</span>
    <span class="n">index_ftrap</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AngFreqs</span> <span class="o">==</span> <span class="n">ClosestToAngTrapFreqGuess</span><span class="p">)</span>
    <span class="n">ftrap</span> <span class="o">=</span> <span class="n">AngFreqs</span><span class="p">[</span><span class="n">index_ftrap</span><span class="p">]</span>

    <span class="n">f_fit_lower</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">AngFreqs</span><span class="p">,</span> <span class="n">ftrap</span> <span class="o">-</span> <span class="n">Angbandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">f_fit_upper</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">AngFreqs</span><span class="p">,</span> <span class="n">ftrap</span> <span class="o">+</span> <span class="n">Angbandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">indx_fit_lower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AngFreqs</span> <span class="o">==</span> <span class="n">f_fit_lower</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">indx_fit_upper</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AngFreqs</span> <span class="o">==</span> <span class="n">f_fit_upper</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#    print(f_fit_lower, f_fit_upper)</span>
<span class="c1">#    print(AngFreqs[indx_fit_lower], AngFreqs[indx_fit_upper])</span>

    <span class="c1"># find highest point in region about guess for trap frequency - use that</span>
    <span class="c1"># as guess for trap frequency and recalculate region about the trap</span>
    <span class="c1"># frequency</span>
    <span class="n">index_ftrap</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">PSD</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span>
        <span class="n">Data</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">indx_fit_lower</span><span class="p">:</span><span class="n">indx_fit_upper</span><span class="p">]))</span>

    <span class="n">ftrap</span> <span class="o">=</span> <span class="n">AngFreqs</span><span class="p">[</span><span class="n">index_ftrap</span><span class="p">]</span>

<span class="c1">#    print(ftrap)</span>

    <span class="n">f_fit_lower</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">AngFreqs</span><span class="p">,</span> <span class="n">ftrap</span> <span class="o">-</span> <span class="n">Angbandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">f_fit_upper</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">AngFreqs</span><span class="p">,</span> <span class="n">ftrap</span> <span class="o">+</span> <span class="n">Angbandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">indx_fit_lower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AngFreqs</span> <span class="o">==</span> <span class="n">f_fit_lower</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">indx_fit_upper</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">AngFreqs</span> <span class="o">==</span> <span class="n">f_fit_upper</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">PSD_smoothed</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">PSD</span><span class="p">,</span> <span class="n">NMovAve</span><span class="p">)</span>
    <span class="n">freqs_smoothed</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">AngFreqs</span><span class="p">,</span> <span class="n">NMovAve</span><span class="p">)</span>

    <span class="n">logPSD_smoothed</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">PSD_smoothed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_theory_PSD_curve_fit</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">TrapFreq</span><span class="p">,</span> <span class="n">BigGamma</span><span class="p">):</span>
        <span class="n">Theory_PSD</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> \
            <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_PSD_fitting_eqn</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">TrapFreq</span><span class="p">,</span> <span class="n">BigGamma</span><span class="p">,</span> <span class="n">freqs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">A</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">TrapFreq</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">BigGamma</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span><span class="n">e9</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Theory_PSD</span>

    <span class="n">datax</span> <span class="o">=</span> <span class="n">freqs_smoothed</span><span class="p">[</span><span class="n">indx_fit_lower</span><span class="p">:</span><span class="n">indx_fit_upper</span><span class="p">]</span>
    <span class="n">datay</span> <span class="o">=</span> <span class="n">logPSD_smoothed</span><span class="p">[</span><span class="n">indx_fit_lower</span><span class="p">:</span><span class="n">indx_fit_upper</span><span class="p">]</span>

    <span class="n">p0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">AGuess</span><span class="p">,</span> <span class="n">ftrap</span><span class="p">,</span> <span class="n">GammaGuess</span><span class="p">])</span>

    <span class="n">Params_Fit</span><span class="p">,</span> <span class="n">Params_Fit_Err</span> <span class="o">=</span> <span class="n">fit_curvefit</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span>
                                              <span class="n">datax</span><span class="p">,</span> <span class="n">datay</span><span class="p">,</span> <span class="n">calc_theory_PSD_curve_fit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">MakeFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="n">PSDTheory_fit_initial</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
            <span class="n">_PSD_fitting_eqn</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">freqs_smoothed</span><span class="p">))</span>

        <span class="n">PSDTheory_fit</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
            <span class="n">_PSD_fitting_eqn</span><span class="p">(</span><span class="n">Params_Fit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">Params_Fit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">Params_Fit</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                             <span class="n">freqs_smoothed</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AngFreqs</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">Data</span><span class="o">.</span><span class="n">PSD</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw PSD Data&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs_smoothed</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">logPSD_smoothed</span> <span class="o">/</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;smoothed&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs_smoothed</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PSDTheory_fit_initial</span> <span class="o">/</span> <span class="mi">10</span><span class="p">),</span>
                <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;initial vals&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs_smoothed</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PSDTheory_fit</span> <span class="o">/</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fitted vals&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([(</span><span class="n">ftrap</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">Angbandwidth</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">ftrap</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">Angbandwidth</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([(</span><span class="n">ftrap</span> <span class="o">-</span> <span class="n">Angbandwidth</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="n">ftrap</span> <span class="o">-</span> <span class="n">Angbandwidth</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)],</span>
                <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">logPSD_smoothed</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)),</span>
                 <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">logPSD_smoothed</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([(</span><span class="n">ftrap</span> <span class="o">+</span> <span class="n">Angbandwidth</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="n">ftrap</span> <span class="o">+</span> <span class="n">Angbandwidth</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)],</span>
                <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">logPSD_smoothed</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)),</span>
                 <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">logPSD_smoothed</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$S_</span><span class="si">{xx}</span><span class="s2">$ ($v^2/Hz$)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Params_Fit</span><span class="p">,</span> <span class="n">Params_Fit_Err</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Params_Fit</span><span class="p">,</span> <span class="n">Params_Fit_Err</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="extract_parameters"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.extract_parameters">[docs]</a><span class="k">def</span> <span class="nf">extract_parameters</span><span class="p">(</span><span class="n">Pressure</span><span class="p">,</span> <span class="n">PressureErr</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">AErr</span><span class="p">,</span> <span class="n">Gamma0</span><span class="p">,</span> <span class="n">Gamma0Err</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the radius, mass and conversion factor and thier uncertainties.</span>
<span class="sd">    For values to be correct data must have been taken with feedback off and</span>
<span class="sd">    at pressures of around 1mbar (this is because the equations assume</span>
<span class="sd">    harmonic motion and at lower pressures the uncooled particle experiences</span>
<span class="sd">    anharmonic motion (due to exploring furthur outside the middle of the trap).</span>
<span class="sd">    When cooled the value of Gamma (the damping) is a combination of the</span>
<span class="sd">    enviromental damping and feedback damping and so is not the correct value</span>
<span class="sd">    for use in this equation (as it requires the enviromental damping).</span>
<span class="sd">    Environmental damping can be predicted though as A=const*Gamma0. By</span>
<span class="sd">    fitting to 1mbar data one can find the value of the const and therefore</span>
<span class="sd">    Gamma0 = A/const</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Pressure : float</span>
<span class="sd">        Pressure in mbar when the data was taken</span>
<span class="sd">    PressureErr : float</span>
<span class="sd">        Error in the Pressure as a decimal (e.g. 15% error is 0.15) </span>
<span class="sd">    A : float</span>
<span class="sd">        Fitting constant A</span>
<span class="sd">        A = γ**2*Γ_0*(K_b*T_0)/(π*m)</span>
<span class="sd">        where:</span>
<span class="sd">            γ = conversionFactor</span>
<span class="sd">            Γ_0 = Damping factor due to environment</span>
<span class="sd">            π = pi</span>
<span class="sd">    AErr : float</span>
<span class="sd">        Error in Fitting constant A</span>
<span class="sd">    Gamma0 : float</span>
<span class="sd">        The enviromental damping factor Gamma_0 = Γ_0</span>
<span class="sd">    Gamma0Err : float</span>
<span class="sd">        The error in the enviromental damping factor Gamma_0 = Γ_0</span>

<span class="sd">    Returns:</span>
<span class="sd">    Params : list</span>
<span class="sd">        [radius, mass, conversionFactor]</span>
<span class="sd">        The extracted parameters</span>
<span class="sd">    ParamsError : list</span>
<span class="sd">        [radiusError, massError, conversionFactorError]</span>
<span class="sd">        The error in the extracted parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Pressure</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">Pressure</span>  <span class="c1"># conversion to Pascals</span>

    <span class="n">rho</span> <span class="o">=</span> <span class="mi">2200</span>  <span class="c1"># kgm^3</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="mf">0.372e-9</span>  <span class="c1"># m I&#39;Hanlon, 2003</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># kelvin</span>
    <span class="n">kB</span> <span class="o">=</span> <span class="mf">1.38e-23</span>  <span class="c1"># m^2 kg s^-2 K-1</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mf">18.27e-6</span>  <span class="c1"># Pa s, viscosity of air</span>

    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.169</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">dm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">kB</span> <span class="o">*</span> <span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pressure</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gamma0</span><span class="p">)</span>
    <span class="n">err_radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> \
        <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">PressureErr</span> <span class="o">*</span> <span class="n">Pressure</span><span class="p">)</span> <span class="o">/</span> <span class="n">Pressure</span><span class="p">)</span>
                 <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Gamma0Err</span> <span class="o">/</span> <span class="n">Gamma0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">err_mass</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">err_radius</span> <span class="o">/</span> <span class="n">radius</span>
    <span class="n">conversionFactor</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">/</span> <span class="p">(</span><span class="n">kB</span> <span class="o">*</span> <span class="n">T0</span> <span class="o">*</span> <span class="n">Gamma0</span><span class="p">))</span>
    <span class="n">err_conversionFactor</span> <span class="o">=</span> <span class="n">conversionFactor</span> <span class="o">*</span> \
        <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">AErr</span> <span class="o">/</span> <span class="n">A</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">err_mass</span> <span class="o">/</span> <span class="n">mass</span><span class="p">)</span>
                 <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Gamma0Err</span> <span class="o">/</span> <span class="n">Gamma0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">radius</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">conversionFactor</span><span class="p">],</span> <span class="p">[</span><span class="n">err_radius</span><span class="p">,</span> <span class="n">err_mass</span><span class="p">,</span> <span class="n">err_conversionFactor</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_ZXY_freqs"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.get_ZXY_freqs">[docs]</a><span class="k">def</span> <span class="nf">get_ZXY_freqs</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">zfreq</span><span class="p">,</span> <span class="n">xfreq</span><span class="p">,</span> <span class="n">yfreq</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the exact z, x and y peak frequencies from approximate</span>
<span class="sd">    frequencies by finding the highest peak in the PSD &quot;close to&quot; the</span>
<span class="sd">    approximate peak frequency. By &quot;close to&quot; I mean within the range:</span>
<span class="sd">    approxFreq - bandwidth/2 to approxFreq + bandwidth/2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Data : DataObject</span>
<span class="sd">        DataObject containing the data for which you want to determine the</span>
<span class="sd">        z, x and y frequencies.</span>
<span class="sd">    zfreq : float</span>
<span class="sd">        An approximate frequency for the z peak</span>
<span class="sd">    xfreq : float</span>
<span class="sd">        An approximate frequency for the z peak</span>
<span class="sd">    yfreq : float</span>
<span class="sd">        An approximate frequency for the z peak</span>
<span class="sd">    bandwidth : float, optional</span>
<span class="sd">        The bandwidth around the approximate peak to look for the actual peak. The default value is 5000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    trapfreqs : list</span>
<span class="sd">        List containing the trap frequencies in the following order (z, x, y)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trapfreqs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="n">zfreq</span><span class="p">,</span> <span class="n">xfreq</span><span class="p">,</span> <span class="n">yfreq</span><span class="p">]:</span>
        <span class="n">z_f_fit_lower</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">freq</span> <span class="o">-</span> <span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">z_f_fit_upper</span> <span class="o">=</span> <span class="n">take_closest</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">freq</span> <span class="o">+</span> <span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">z_indx_fit_lower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">freqs</span> <span class="o">==</span> <span class="n">z_f_fit_lower</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">z_indx_fit_upper</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">freqs</span> <span class="o">==</span> <span class="n">z_f_fit_upper</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">z_index_ftrap</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">PSD</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">Data</span><span class="o">.</span><span class="n">PSD</span><span class="p">[</span><span class="n">z_indx_fit_lower</span><span class="p">:</span><span class="n">z_indx_fit_upper</span><span class="p">]))</span>
        <span class="c1"># find highest point in region about guess for trap frequency</span>
        <span class="c1"># use that as guess for trap frequency and recalculate region</span>
        <span class="c1"># about the trap frequency</span>
        <span class="n">z_ftrap</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">z_index_ftrap</span><span class="p">]</span>
        <span class="n">trapfreqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_ftrap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trapfreqs</span></div>


<div class="viewcode-block" id="get_ZXY_data"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.get_ZXY_data">[docs]</a><span class="k">def</span> <span class="nf">get_ZXY_data</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span> <span class="n">FractionOfSampleFreq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">zwidth</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">xwidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">ywidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                 <span class="n">ztransition</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">xtransition</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">ytransition</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                 <span class="n">filterImplementation</span><span class="o">=</span><span class="s2">&quot;filtfilt&quot;</span><span class="p">,</span>
                 <span class="n">timeStart</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="n">timeEnd</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span>
                 <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a Data object and the frequencies of the z, x and y peaks (and some</span>
<span class="sd">    optional parameters for the created filters) this function extracts the</span>
<span class="sd">    individual z, x and y signals (in volts) by creating IIR filters and filtering</span>
<span class="sd">    the Data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Data : DataObject</span>
<span class="sd">        DataObject containing the data for which you want to extract the</span>
<span class="sd">        z, x and y signals.</span>
<span class="sd">    zf : float</span>
<span class="sd">        The frequency of the z peak in the PSD</span>
<span class="sd">    xf : float</span>
<span class="sd">        The frequency of the x peak in the PSD</span>
<span class="sd">    yf : float</span>
<span class="sd">        The frequency of the y peak in the PSD</span>
<span class="sd">    FractionOfSampleFreq : integer, optional</span>
<span class="sd">        The fraction of the sample frequency to sub-sample the data by.</span>
<span class="sd">        This sometimes needs to be done because a filter with the appropriate</span>
<span class="sd">        frequency response may not be generated using the sample rate at which</span>
<span class="sd">        the data was taken. Increasing this number means the x, y and z signals</span>
<span class="sd">        produced by this function will be sampled at a lower rate but a higher</span>
<span class="sd">        number means a higher chance that the filter produced will have a nice</span>
<span class="sd">        frequency response.</span>
<span class="sd">    zwidth : float, optional</span>
<span class="sd">        The width of the pass-band of the IIR filter to be generated to</span>
<span class="sd">        filter Z.</span>
<span class="sd">    xwidth : float, optional</span>
<span class="sd">        The width of the pass-band of the IIR filter to be generated to</span>
<span class="sd">        filter X.</span>
<span class="sd">    ywidth : float, optional</span>
<span class="sd">        The width of the pass-band of the IIR filter to be generated to</span>
<span class="sd">        filter Y.</span>
<span class="sd">    ztransition : float, optional</span>
<span class="sd">        The width of the transition-band of the IIR filter to be generated to</span>
<span class="sd">        filter Z.</span>
<span class="sd">    xtransition : float, optional</span>
<span class="sd">        The width of the transition-band of the IIR filter to be generated to</span>
<span class="sd">        filter X.</span>
<span class="sd">    ytransition : float, optional</span>
<span class="sd">        The width of the transition-band of the IIR filter to be generated to</span>
<span class="sd">        filter Y.</span>
<span class="sd">    filterImplementation : string, optional</span>
<span class="sd">        filtfilt or lfilter - use scipy.filtfilt or lfilter</span>
<span class="sd">        default: filtfilt</span>
<span class="sd">    timeStart : float, optional</span>
<span class="sd">        Starting time for filtering</span>
<span class="sd">    timeEnd : float, optional</span>
<span class="sd">        Ending time for filtering</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">        If True - plot unfiltered and filtered PSD for z, x and y.</span>
<span class="sd">        If False - don&#39;t plot anything</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    zdata : ndarray</span>
<span class="sd">        Array containing the z signal in volts with time.</span>
<span class="sd">    xdata : ndarray</span>
<span class="sd">        Array containing the x signal in volts with time.</span>
<span class="sd">    ydata : ndarray</span>
<span class="sd">        Array containing the y signal in volts with time.</span>
<span class="sd">    timedata : ndarray</span>
<span class="sd">        Array containing the time data to go with the z, x, and y signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">timeStart</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
        <span class="n">timeStart</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">timeEnd</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
        <span class="n">timeEnd</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">StartIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">take_closest</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">timeStart</span><span class="p">))</span>
    <span class="n">EndIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">take_closest</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">timeEnd</span><span class="p">))</span>

    <span class="n">SAMPLEFREQ</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">SampleFreq</span> <span class="o">/</span> <span class="n">FractionOfSampleFreq</span>

    <span class="k">if</span> <span class="n">filterImplementation</span> <span class="o">==</span> <span class="s2">&quot;filtfilt&quot;</span><span class="p">:</span>
        <span class="n">ApplyFilter</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span>
    <span class="k">elif</span> <span class="n">filterImplementation</span> <span class="o">==</span> <span class="s2">&quot;lfilter&quot;</span><span class="p">:</span>
        <span class="n">ApplyFilter</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;filterImplementation must be one of [filtfilt, lfilter] you entered: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">filterImplementation</span><span class="p">))</span>

    <span class="n">input_signal</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">voltage</span><span class="p">[</span><span class="n">StartIndex</span><span class="p">:</span> <span class="n">EndIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">FractionOfSampleFreq</span><span class="p">]</span>

    <span class="n">bZ</span><span class="p">,</span> <span class="n">aZ</span> <span class="o">=</span> <span class="n">IIRFilterDesign</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span> <span class="n">zwidth</span><span class="p">,</span> <span class="n">ztransition</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">GainStop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">zdata</span> <span class="o">=</span> <span class="n">ApplyFilter</span><span class="p">(</span><span class="n">bZ</span><span class="p">,</span> <span class="n">aZ</span><span class="p">,</span> <span class="n">input_signal</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">zdata</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Value Error: FractionOfSampleFreq must be higher, a sufficiently small sample frequency should be used to produce a working IIR filter.&quot;</span><span class="p">)</span>

    <span class="n">bX</span><span class="p">,</span> <span class="n">aX</span> <span class="o">=</span> <span class="n">IIRFilterDesign</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">xwidth</span><span class="p">,</span> <span class="n">xtransition</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">GainStop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">xdata</span> <span class="o">=</span> <span class="n">ApplyFilter</span><span class="p">(</span><span class="n">bX</span><span class="p">,</span> <span class="n">aX</span><span class="p">,</span> <span class="n">input_signal</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Value Error: FractionOfSampleFreq must be higher, a sufficiently small sample frequency should be used to produce a working IIR filter.&quot;</span><span class="p">)</span>

    <span class="n">bY</span><span class="p">,</span> <span class="n">aY</span> <span class="o">=</span> <span class="n">IIRFilterDesign</span><span class="p">(</span><span class="n">yf</span><span class="p">,</span> <span class="n">ywidth</span><span class="p">,</span> <span class="n">ytransition</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">GainStop</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">ydata</span> <span class="o">=</span> <span class="n">ApplyFilter</span><span class="p">(</span><span class="n">bY</span><span class="p">,</span> <span class="n">aY</span><span class="p">,</span> <span class="n">input_signal</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Value Error: FractionOfSampleFreq must be higher, a sufficiently small sample frequency should be used to produce a working IIR filter.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NPerSegment</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e5</span><span class="p">:</span>
            <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="n">e5</span><span class="p">)</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">PSD</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span>
            <span class="n">input_signal</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">f_z</span><span class="p">,</span> <span class="n">PSD_z</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">zdata</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">f_y</span><span class="p">,</span> <span class="n">PSD_y</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">ydata</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">f_x</span><span class="p">,</span> <span class="n">PSD_x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">PSD</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_z</span><span class="p">,</span> <span class="n">PSD_z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_x</span><span class="p">,</span> <span class="n">PSD_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_y</span><span class="p">,</span> <span class="n">PSD_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="n">_ply</span><span class="o">.</span><span class="n">semilogy</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">zf</span> <span class="o">-</span> <span class="n">zwidth</span> <span class="o">-</span> <span class="n">ztransition</span><span class="p">,</span> <span class="n">yf</span> <span class="o">+</span> <span class="n">ywidth</span> <span class="o">+</span> <span class="n">ytransition</span><span class="p">])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">timedata</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">StartIndex</span><span class="p">:</span> <span class="n">EndIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="n">FractionOfSampleFreq</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">timedata</span></div>


<div class="viewcode-block" id="get_ZXY_data_IFFT"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.get_ZXY_data_IFFT">[docs]</a><span class="k">def</span> <span class="nf">get_ZXY_data_IFFT</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">zf</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span>
                      <span class="n">zwidth</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">xwidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">ywidth</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                      <span class="n">timeStart</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="n">timeEnd</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span>
                      <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a Data object and the frequencies of the z, x and y peaks (and some</span>
<span class="sd">    optional parameters for the created filters) this function extracts the</span>
<span class="sd">    individual z, x and y signals (in volts) by creating IIR filters and filtering</span>
<span class="sd">    the Data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Data : DataObject</span>
<span class="sd">        DataObject containing the data for which you want to extract the</span>
<span class="sd">        z, x and y signals.</span>
<span class="sd">    zf : float</span>
<span class="sd">        The frequency of the z peak in the PSD</span>
<span class="sd">    xf : float</span>
<span class="sd">        The frequency of the x peak in the PSD</span>
<span class="sd">    yf : float</span>
<span class="sd">        The frequency of the y peak in the PSD</span>
<span class="sd">    zwidth : float, optional</span>
<span class="sd">        The width of the pass-band of the IIR filter to be generated to</span>
<span class="sd">        filter Z.</span>
<span class="sd">    xwidth : float, optional</span>
<span class="sd">        The width of the pass-band of the IIR filter to be generated to</span>
<span class="sd">        filter X.</span>
<span class="sd">    ywidth : float, optional</span>
<span class="sd">        The width of the pass-band of the IIR filter to be generated to</span>
<span class="sd">        filter Y.</span>
<span class="sd">    timeStart : float, optional</span>
<span class="sd">        Starting time for filtering</span>
<span class="sd">    timeEnd : float, optional</span>
<span class="sd">        Ending time for filtering</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">        If True - plot unfiltered and filtered PSD for z, x and y.</span>
<span class="sd">        If False - don&#39;t plot anything</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    zdata : ndarray</span>
<span class="sd">        Array containing the z signal in volts with time.</span>
<span class="sd">    xdata : ndarray</span>
<span class="sd">        Array containing the x signal in volts with time.</span>
<span class="sd">    ydata : ndarray</span>
<span class="sd">        Array containing the y signal in volts with time.</span>
<span class="sd">    timedata : ndarray</span>
<span class="sd">        Array containing the time data to go with the z, x, and y signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">timeStart</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
        <span class="n">timeStart</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">timeEnd</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
        <span class="n">timeEnd</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">StartIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">take_closest</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">timeStart</span><span class="p">))</span>
    <span class="n">EndIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">take_closest</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">timeEnd</span><span class="p">))</span>

    <span class="n">SAMPLEFREQ</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">SampleFreq</span>

    <span class="n">input_signal</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">voltage</span><span class="p">[</span><span class="n">StartIndex</span><span class="p">:</span> <span class="n">EndIndex</span><span class="p">]</span>

    <span class="n">zdata</span> <span class="o">=</span> <span class="n">IFFT_filter</span><span class="p">(</span><span class="n">input_signal</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">zf</span> <span class="o">-</span>
                        <span class="n">zwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">zf</span> <span class="o">+</span> <span class="n">zwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">xdata</span> <span class="o">=</span> <span class="n">IFFT_filter</span><span class="p">(</span><span class="n">input_signal</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">xf</span> <span class="o">-</span>
                        <span class="n">zwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xf</span> <span class="o">+</span> <span class="n">zwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">ydata</span> <span class="o">=</span> <span class="n">IFFT_filter</span><span class="p">(</span><span class="n">input_signal</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">yf</span> <span class="o">-</span>
                        <span class="n">zwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">yf</span> <span class="o">+</span> <span class="n">zwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NPerSegment</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e5</span><span class="p">:</span>
            <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="n">e5</span><span class="p">)</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">PSD</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span>
            <span class="n">input_signal</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">f_z</span><span class="p">,</span> <span class="n">PSD_z</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">zdata</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">f_y</span><span class="p">,</span> <span class="n">PSD_y</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">ydata</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">f_x</span><span class="p">,</span> <span class="n">PSD_x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">SAMPLEFREQ</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">PSD</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_z</span><span class="p">,</span> <span class="n">PSD_z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_x</span><span class="p">,</span> <span class="n">PSD_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_y</span><span class="p">,</span> <span class="n">PSD_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">zf</span> <span class="o">-</span> <span class="n">zwidth</span><span class="p">,</span> <span class="n">yf</span> <span class="o">+</span> <span class="n">ywidth</span><span class="p">])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">r&#39;$S_</span><span class="si">{xx}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;filepath = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">filepath</span><span class="p">))</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">timedata</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">StartIndex</span><span class="p">:</span> <span class="n">EndIndex</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">zdata</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">timedata</span></div>


<div class="viewcode-block" id="animate"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.animate">[docs]</a><span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">zdata</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span>
            <span class="n">conversionFactor</span><span class="p">,</span> <span class="n">timedata</span><span class="p">,</span>
            <span class="n">BoxSize</span><span class="p">,</span>
            <span class="n">timeSteps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;particle&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Animates the particle&#39;s motion given the z, x and y signal (in Volts)</span>
<span class="sd">    and the conversion factor (to convert between V and nm).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zdata : ndarray</span>
<span class="sd">        Array containing the z signal in volts with time.</span>
<span class="sd">    xdata : ndarray</span>
<span class="sd">        Array containing the x signal in volts with time.</span>
<span class="sd">    ydata : ndarray</span>
<span class="sd">        Array containing the y signal in volts with time.</span>
<span class="sd">    conversionFactor : float</span>
<span class="sd">        conversion factor (in units of Volts/Metre)</span>
<span class="sd">    timedata : ndarray</span>
<span class="sd">        Array containing the time data in seconds.</span>
<span class="sd">    BoxSize : float</span>
<span class="sd">        The size of the box in which to animate the particle - in nm</span>
<span class="sd">    timeSteps : int, optional</span>
<span class="sd">        Number of time steps to animate</span>
<span class="sd">    filename : string, optional</span>
<span class="sd">        filename to create the mp4 under (&lt;filename&gt;.mp4)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timePerFrame</span> <span class="o">=</span> <span class="mf">0.203</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will take ~ </span><span class="si">{}</span><span class="s2"> minutes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timePerFrame</span> <span class="o">*</span> <span class="n">timeSteps</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>

    <span class="n">conv</span> <span class="o">=</span> <span class="n">conversionFactor</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span>

    <span class="n">ZBoxStart</span> <span class="o">=</span> <span class="o">-</span><span class="n">BoxSize</span>  <span class="c1"># 1/conv*(_np.mean(zdata)-0.06)</span>
    <span class="n">ZBoxEnd</span> <span class="o">=</span> <span class="n">BoxSize</span>  <span class="c1"># 1/conv*(_np.mean(zdata)+0.06)</span>
    <span class="n">XBoxStart</span> <span class="o">=</span> <span class="o">-</span><span class="n">BoxSize</span>  <span class="c1"># 1/conv*(_np.mean(xdata)-0.06)</span>
    <span class="n">XBoxEnd</span> <span class="o">=</span> <span class="n">BoxSize</span>  <span class="c1"># 1/conv*(_np.mean(xdata)+0.06)</span>
    <span class="n">YBoxStart</span> <span class="o">=</span> <span class="o">-</span><span class="n">BoxSize</span>  <span class="c1"># 1/conv*(_np.mean(ydata)-0.06)</span>
    <span class="n">YBoxEnd</span> <span class="o">=</span> <span class="n">BoxSize</span>  <span class="c1"># 1/conv*(_np.mean(ydata)+0.06)</span>

    <span class="n">FrameInterval</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># how many timesteps = 1 frame in animation</span>

    <span class="n">a</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">a</span>
    <span class="n">myFPS</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">myBitrate</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e6</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> us&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timedata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X (nm)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">XBoxStart</span><span class="p">,</span> <span class="n">XBoxEnd</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y (nm)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">YBoxStart</span><span class="p">,</span> <span class="n">YBoxEnd</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z (nm)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="n">ZBoxStart</span><span class="p">,</span> <span class="n">ZBoxEnd</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>

    <span class="c1">#ax.view_init(0, 0)</span>

    <span class="k">def</span> <span class="nf">setup_plot</span><span class="p">():</span>
        <span class="n">XArray</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">YArray</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ZArray</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">zdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">XArray</span><span class="p">,</span> <span class="n">YArray</span><span class="p">,</span> <span class="n">ZArray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scatter</span><span class="p">,</span>

    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="c1"># print &quot;\r {}&quot;.format(i),</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frame: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> us&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timedata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X (nm)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">XBoxStart</span><span class="p">,</span> <span class="n">XBoxEnd</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y (nm)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">YBoxStart</span><span class="p">,</span> <span class="n">YBoxEnd</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z (nm)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="n">ZBoxStart</span><span class="p">,</span> <span class="n">ZBoxEnd</span><span class="p">])</span>
        <span class="n">XArray</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">xdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">YArray</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">ydata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ZArray</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">zdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">XArray</span><span class="p">,</span> <span class="n">YArray</span><span class="p">,</span> <span class="n">ZArray</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">XArray</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">ZBoxEnd</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="o">-</span><span class="n">XBoxEnd</span><span class="p">],</span> <span class="p">[</span><span class="n">YArray</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">YBoxEnd</span><span class="p">],</span> <span class="p">[</span><span class="n">ZArray</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

        <span class="n">Xx</span><span class="p">,</span> <span class="n">Yx</span><span class="p">,</span> <span class="n">Zx</span><span class="p">,</span> <span class="n">Xy</span><span class="p">,</span> <span class="n">Yy</span><span class="p">,</span> <span class="n">Zy</span><span class="p">,</span> <span class="n">Xz</span><span class="p">,</span> <span class="n">Yz</span><span class="p">,</span> <span class="n">Zz</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>

            <span class="n">Xlast</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">xdata</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">Ylast</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">ydata</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">Zlast</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">zdata</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>

            <span class="n">Alpha</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">Alpha</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">Xlast</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">10</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="n">ZBoxEnd</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">Alpha</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="o">-</span><span class="n">XBoxEnd</span><span class="p">],</span> <span class="p">[</span><span class="n">Ylast</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">10</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">Alpha</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">0</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">YBoxEnd</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">Zlast</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">Alpha</span><span class="p">)</span>

                <span class="n">Xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xlast</span><span class="p">)</span>
                <span class="n">Yx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">Zx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">ZBoxEnd</span><span class="p">)</span>

                <span class="n">Xy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">XBoxEnd</span><span class="p">)</span>
                <span class="n">Yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ylast</span><span class="p">)</span>
                <span class="n">Zy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

                <span class="n">Xz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">Yz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">YBoxEnd</span><span class="p">)</span>
                <span class="n">Zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zlast</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">XCur</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">xdata</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">YCur</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">ydata</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ZCur</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">conv</span> <span class="o">*</span> <span class="n">zdata</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">Xlast</span><span class="p">,</span> <span class="n">XCur</span><span class="p">],</span> <span class="p">[</span><span class="n">Ylast</span><span class="p">,</span> <span class="n">YCur</span><span class="p">],</span> <span class="p">[</span><span class="n">Zlast</span><span class="p">,</span> <span class="n">ZCur</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">Xx</span><span class="p">,</span> <span class="n">Yx</span><span class="p">,</span> <span class="n">Zx</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">Xy</span><span class="p">,</span> <span class="n">Yy</span><span class="p">,</span> <span class="n">Zy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">Xz</span><span class="p">,</span> <span class="n">Yz</span><span class="p">,</span> <span class="n">Zz</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scatter</span><span class="p">,</span>

    <span class="n">anim</span> <span class="o">=</span> <span class="n">_animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span>
        <span class="n">timeSteps</span> <span class="o">/</span> <span class="n">FrameInterval</span><span class="p">),</span> <span class="n">init_func</span><span class="o">=</span><span class="n">setup_plot</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;animation.ffmpeg_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/ffmpeg&#39;</span>
    <span class="n">mywriter</span> <span class="o">=</span> <span class="n">_animation</span><span class="o">.</span><span class="n">FFMpegWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="n">myFPS</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="n">myBitrate</span><span class="p">)</span>
    <span class="c1"># , fps = myFPS, bitrate = myBitrate)</span>
    <span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.mp4&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">writer</span><span class="o">=</span><span class="n">mywriter</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="IFFT_filter"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.IFFT_filter">[docs]</a><span class="k">def</span> <span class="nf">IFFT_filter</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">SampleFreq</span><span class="p">,</span> <span class="n">lowerFreq</span><span class="p">,</span> <span class="n">upperFreq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters data using fft -&gt; zeroing out fft bins -&gt; ifft</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Signal : ndarray</span>
<span class="sd">        Signal to be filtered</span>
<span class="sd">    SampleFreq : float</span>
<span class="sd">        Sample frequency of signal</span>
<span class="sd">    lowerFreq : float</span>
<span class="sd">        Lower frequency of bandpass to allow through filter</span>
<span class="sd">    upperFreq : float</span>
<span class="sd">       Upper frequency of bandpass to allow through filter</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FilteredData : ndarray</span>
<span class="sd">        Array containing the filtered data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting fft&quot;</span><span class="p">)</span>
    <span class="n">Signalfft</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting freq calc&quot;</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Signal</span><span class="p">))</span> <span class="o">*</span> <span class="n">SampleFreq</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting bin zeroing&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">freq</span> <span class="o">&lt;</span> <span class="n">lowerFreq</span> <span class="ow">or</span> <span class="n">freq</span> <span class="o">&gt;</span> <span class="n">upperFreq</span><span class="p">:</span>
            <span class="n">Signalfft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting ifft&quot;</span><span class="p">)</span>
    <span class="n">FilteredSignal</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">fftpack</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Signalfft</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">FilteredSignal</span><span class="p">)</span></div>


<div class="viewcode-block" id="IIR_filter_design"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.IIR_filter_design">[docs]</a><span class="k">def</span> <span class="nf">IIR_filter_design</span><span class="p">(</span><span class="n">CentralFreq</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">transitionWidth</span><span class="p">,</span> <span class="n">SampleFreq</span><span class="p">,</span> <span class="n">GainStop</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">GainPass</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the coefficients of an IIR filter.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    CentralFreq : float</span>
<span class="sd">        Central frequency of the IIR filter to be designed</span>
<span class="sd">    bandwidth : float</span>
<span class="sd">        The width of the passband to be created about the central frequency</span>
<span class="sd">    transitionWidth : float</span>
<span class="sd">        The width of the transition band between the pass-band and stop-band</span>
<span class="sd">    SampleFreq : float</span>
<span class="sd">        The sample frequency (rate) of the data to be filtered</span>
<span class="sd">    GainStop : float, optional</span>
<span class="sd">        The dB of attenuation within the stopband (i.e. outside the passband)</span>
<span class="sd">    GainPass : float, optional</span>
<span class="sd">        The dB attenuation inside the passband (ideally close to 0 for a bandpass filter)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    b : ndarray</span>
<span class="sd">        coefficients multiplying the current and past inputs (feedforward coefficients)</span>
<span class="sd">    a : ndarray</span>
<span class="sd">        coefficients multiplying the past outputs (feedback coefficients)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NyquistFreq</span> <span class="o">=</span> <span class="n">SampleFreq</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">CentralFreq</span> <span class="o">+</span> <span class="n">bandwidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">transitionWidth</span> <span class="o">&gt;</span> <span class="n">NyquistFreq</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Need a higher Sample Frequency for this Central Freq, Bandwidth and transition Width&quot;</span><span class="p">)</span>

    <span class="n">CentralFreqNormed</span> <span class="o">=</span> <span class="n">CentralFreq</span> <span class="o">/</span> <span class="n">NyquistFreq</span>
    <span class="n">bandwidthNormed</span> <span class="o">=</span> <span class="n">bandwidth</span> <span class="o">/</span> <span class="n">NyquistFreq</span>
    <span class="n">transitionWidthNormed</span> <span class="o">=</span> <span class="n">transitionWidth</span> <span class="o">/</span> <span class="n">NyquistFreq</span>
    <span class="n">bandpass</span> <span class="o">=</span> <span class="p">[</span><span class="n">CentralFreqNormed</span> <span class="o">-</span> <span class="n">bandwidthNormed</span> <span class="o">/</span>
                <span class="mi">2</span><span class="p">,</span> <span class="n">CentralFreqNormed</span> <span class="o">+</span> <span class="n">bandwidthNormed</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">bandstop</span> <span class="o">=</span> <span class="p">[</span><span class="n">CentralFreqNormed</span> <span class="o">-</span> <span class="n">bandwidthNormed</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">transitionWidthNormed</span><span class="p">,</span>
                <span class="n">CentralFreqNormed</span> <span class="o">+</span> <span class="n">bandwidthNormed</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">transitionWidthNormed</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bandpass</span><span class="p">,</span> <span class="n">bandstop</span><span class="p">)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">iirdesign</span><span class="p">(</span><span class="n">bandpass</span><span class="p">,</span> <span class="n">bandstop</span><span class="p">,</span> <span class="n">GainPass</span><span class="p">,</span> <span class="n">GainStop</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span></div>


<span class="c1">#def IIR_filter_design_New(Order, btype, CriticalFreqs, SampleFreq, StopbandAttenuation=40, ftype=&#39;cheby2&#39;):</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    Function to calculate the coefficients of an IIR filter.</span>
<span class="c1">#</span>
<span class="c1">#    Parameters</span>
<span class="c1">#    ----------</span>
<span class="c1">#    CentralFreq : float</span>
<span class="c1">#        Central frequency of the IIR filter to be designed</span>
<span class="c1">#    bandwidth : float</span>
<span class="c1">#        The width of the passband to be created about the central frequency</span>
<span class="c1">#    transitionWidth : float</span>
<span class="c1">#        The width of the transition band between the pass-band and stop-band</span>
<span class="c1">#    SampleFreq : float</span>
<span class="c1">#        The sample frequency (rate) of the data to be filtered</span>
<span class="c1">#    GainStop : float</span>
<span class="c1">#        The dB of attenuation within the stopband (i.e. outside the passband)</span>
<span class="c1">#    GainPass : float</span>
<span class="c1">#        The dB attenuation inside the passband (ideally close to 0 for a bandpass filter)</span>
<span class="c1">#</span>
<span class="c1">#    Returns</span>
<span class="c1">#    -------</span>
<span class="c1">#    b : ndarray</span>
<span class="c1">#        coefficients multiplying the current and past inputs (feedforward coefficients)</span>
<span class="c1">#    a : ndarray</span>
<span class="c1">#        coefficients multiplying the past outputs (feedback coefficients)</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    NyquistFreq = SampleFreq / 2</span>
<span class="c1">#    if len(CriticalFreqs) &gt; 1:</span>
<span class="c1">#        if (CriticalFreqs[1] &gt; NyquistFreq):</span>
<span class="c1">#            raise ValueError(</span>
<span class="c1">#                &quot;Need a higher Sample Frequency for this Frequency range&quot;)</span>
<span class="c1">#</span>
<span class="c1">#        BandStartNormed = CriticalFreqs[0] / NyquistFreq</span>
<span class="c1">#        BandStopNormed = CriticalFreqs[1] / NyquistFreq</span>
<span class="c1">#</span>
<span class="c1">#        bandpass = [BandStartNormed, BandStopNormed]</span>
<span class="c1">#</span>
<span class="c1">#        b, a = scipy.signal.iirfilter(Order, bandpass, rs=StopbandAttenuation,</span>
<span class="c1">#                                      btype=btype, analog=False, ftype=ftype)</span>
<span class="c1">#    else:</span>
<span class="c1">#        CriticalFreq = CriticalFreqs[0]</span>
<span class="c1">#</span>
<span class="c1">#        if (CriticalFreq &gt; NyquistFreq):</span>
<span class="c1">#            raise ValueError(</span>
<span class="c1">#                &quot;Need a higher Sample Frequency for this Critical Frequency&quot;)</span>
<span class="c1">#</span>
<span class="c1">#        CriticalFreqNormed = CriticalFreq / NyquistFreq</span>
<span class="c1">#</span>
<span class="c1">#        b, a = scipy.signal.iirfilter(Order, CriticalFreqNormed, rs=StopbandAttenuation,</span>
<span class="c1">#                                      btype=btype, analog=False, ftype=ftype)</span>
<span class="c1">#</span>
<span class="c1">#    return b, a</span>


<div class="viewcode-block" id="get_freq_response"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.get_freq_response">[docs]</a><span class="k">def</span> <span class="nf">get_freq_response</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">SampleFreq</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">NumOfFreqs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">whole</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes an array of coefficients and finds the frequency</span>
<span class="sd">    response of the filter using scipy.signal.freqz.</span>
<span class="sd">    ShowFig sets if the response should be plotted</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b : array_like</span>
<span class="sd">        Coefficients multiplying the x values (inputs of the filter)</span>

<span class="sd">    a : array_like</span>
<span class="sd">        Coefficients multiplying the y values (outputs of the filter)</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">        Verbosity of function (i.e. whether to plot frequency and phase</span>
<span class="sd">        response or whether to just return the values.)</span>
<span class="sd">        Options (Default is 1):</span>
<span class="sd">        False - Do not plot anything, just return values</span>
<span class="sd">        True - Plot Frequency and Phase response and return values</span>
<span class="sd">    SampleFreq : float, optional</span>
<span class="sd">        Sample frequency (in Hz) to simulate (used to convert frequency range</span>
<span class="sd">        to normalised frequency range)</span>
<span class="sd">    NumOfFreqs : int, optional</span>
<span class="sd">        Number of frequencies to use to simulate the frequency and phase</span>
<span class="sd">        response of the filter. Default is 500.</span>
<span class="sd">    Whole : bool, optional</span>
<span class="sd">        Sets whether to plot the whole response (0 to sample freq)</span>
<span class="sd">        or just to plot 0 to Nyquist (SampleFreq/2): </span>
<span class="sd">        False - (default) plot 0 to Nyquist (SampleFreq/2)</span>
<span class="sd">        True - plot the whole response (0 to sample freq)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freqList : ndarray</span>
<span class="sd">        Array containing the frequencies at which the gain is calculated</span>
<span class="sd">    GainArray : ndarray</span>
<span class="sd">        Array containing the gain in dB of the filter when simulated</span>
<span class="sd">        (20*log_10(A_out/A_in))</span>
<span class="sd">    PhaseDiffArray : ndarray</span>
<span class="sd">        Array containing the phase response of the filter - phase</span>
<span class="sd">        difference between the input signal and output signal at</span>
<span class="sd">        different frequencies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">NumOfFreqs</span><span class="p">,</span> <span class="n">whole</span><span class="o">=</span><span class="n">whole</span><span class="p">)</span>
    <span class="n">freqList</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">SampleFreq</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">himag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hi</span><span class="o">.</span><span class="n">imag</span> <span class="k">for</span> <span class="n">hi</span> <span class="ow">in</span> <span class="n">h</span><span class="p">])</span>
    <span class="n">GainArray</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
    <span class="n">PhaseDiffArray</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig1</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqList</span><span class="p">,</span> <span class="n">GainArray</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Specified Filter&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Frequency Response&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SampleFreq</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">((</span><span class="s2">&quot;$\Omega$ - Normalized frequency &quot;</span>
                           <span class="s2">&quot;($\pi$=Nyquist Frequency)&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Gain (dB)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">SampleFreq</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">fig2</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqList</span><span class="p">,</span> <span class="n">PhaseDiffArray</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Specified Filter&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Phase Response&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SampleFreq</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">((</span><span class="s2">&quot;$\Omega$ - Normalized frequency &quot;</span>
                           <span class="s2">&quot;($\pi$=Nyquist Frequency)&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;frequency (Hz)&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Phase Difference&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">SampleFreq</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">freqList</span><span class="p">,</span> <span class="n">GainArray</span><span class="p">,</span> <span class="n">PhaseDiffArray</span></div>


<div class="viewcode-block" id="multi_plot_PSD"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.multi_plot_PSD">[docs]</a><span class="k">def</span> <span class="nf">multi_plot_PSD</span><span class="p">(</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="n">e3</span><span class="p">],</span> <span class="n">LabelArray</span><span class="o">=</span><span class="p">[],</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot the pulse spectral density for multiple data sets on the same</span>
<span class="sd">    axes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    DataArray - array-like</span>
<span class="sd">        array of DataObject instances for which to plot the PSDs</span>
<span class="sd">    xlim - array-like, optional</span>
<span class="sd">        2 element array specifying the lower and upper x limit for which to</span>
<span class="sd">        plot the Power Spectral Density</span>
<span class="sd">    LabelArray - array-like, optional</span>
<span class="sd">        array of labels for each data-set to be plotted</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">       If True runs plt.show() before returning figure</span>
<span class="sd">       if False it just returns the figure object.</span>
<span class="sd">       (the default is True, it shows the figure)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure object</span>
<span class="sd">        The figure object created</span>
<span class="sd">    ax : matplotlib.axes.Axes object</span>
<span class="sd">        The axes object created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">LabelArray</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">LabelArray</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DataSet </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DataArray</span><span class="p">),</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DataArray</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">PSD</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">LabelArray</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;PSD ($v^2/Hz$)&quot;</span><span class="p">)</span>

    <span class="n">_plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;filedir=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DataArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filedir</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="multi_plot_time"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.multi_plot_time">[docs]</a><span class="k">def</span> <span class="nf">multi_plot_time</span><span class="p">(</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">SubSampleN</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">LabelArray</span><span class="o">=</span><span class="p">[],</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot the time trace for multiple data sets on the same axes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    DataArray : array-like</span>
<span class="sd">        array of DataObject instances for which to plot the PSDs</span>
<span class="sd">    SubSampleN : int, optional</span>
<span class="sd">        Number of intervals between points to remove (to sub-sample data so</span>
<span class="sd">        that you effectively have lower sample rate to make plotting easier</span>
<span class="sd">        and quicker.</span>
<span class="sd">    xlim : array-like, optional</span>
<span class="sd">        2 element array specifying the lower and upper x limit for which to</span>
<span class="sd">        plot the time signal</span>
<span class="sd">    LabelArray : array-like, optional</span>
<span class="sd">        array of labels for each data-set to be plotted</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">       If True runs plt.show() before returning figure</span>
<span class="sd">       if False it just returns the figure object.</span>
<span class="sd">       (the default is True, it shows the figure) </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure object</span>
<span class="sd">        The figure object created</span>
<span class="sd">    ax : matplotlib.axes.Axes object</span>
<span class="sd">        The axes object created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">LabelArray</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">LabelArray</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DataSet </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DataArray</span><span class="p">),</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DataArray</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[::</span><span class="n">SubSampleN</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">voltage</span><span class="p">[::</span><span class="n">SubSampleN</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">LabelArray</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;voltage (V)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="multi_subplots_time"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.multi_subplots_time">[docs]</a><span class="k">def</span> <span class="nf">multi_subplots_time</span><span class="p">(</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">SubSampleN</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">LabelArray</span><span class="o">=</span><span class="p">[],</span> <span class="n">ShowFig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot the time trace on multiple axes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    DataArray : array-like</span>
<span class="sd">        array of DataObject instances for which to plot the PSDs</span>
<span class="sd">    SubSampleN : int, optional</span>
<span class="sd">        Number of intervals between points to remove (to sub-sample data so</span>
<span class="sd">        that you effectively have lower sample rate to make plotting easier</span>
<span class="sd">        and quicker.</span>
<span class="sd">    xlim : array-like, optional</span>
<span class="sd">        2 element array specifying the lower and upper x limit for which to</span>
<span class="sd">        plot the time signal</span>
<span class="sd">    LabelArray : array-like, optional</span>
<span class="sd">        array of labels for each data-set to be plotted</span>
<span class="sd">    ShowFig : bool, optional</span>
<span class="sd">       If True runs plt.show() before returning figure</span>
<span class="sd">       if False it just returns the figure object.</span>
<span class="sd">       (the default is True, it shows the figure) </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure object</span>
<span class="sd">        The figure object created</span>
<span class="sd">    axs : list of matplotlib.axes.Axes objects</span>
<span class="sd">        The list of axes object created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NumDataSets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DataArray</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">LabelArray</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">LabelArray</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DataSet </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">DataArray</span><span class="p">),</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">NumDataSets</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DataArray</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">[::</span><span class="n">SubSampleN</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">voltage</span><span class="p">[::</span><span class="n">SubSampleN</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">LabelArray</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;voltage (V)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlim</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ShowFig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span></div>


<div class="viewcode-block" id="calc_PSD"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.calc_PSD">[docs]</a><span class="k">def</span> <span class="nf">calc_PSD</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">SampleFreq</span><span class="p">,</span> <span class="n">NPerSegment</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s2">&quot;hann&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts the pulse spectral density (PSD) from the data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Signal : array-like</span>
<span class="sd">        Array containing the signal to have the PSD calculated for</span>
<span class="sd">    SampleFreq : float</span>
<span class="sd">        Sample frequency of the signal array</span>
<span class="sd">    NPerSegment : int, optional</span>
<span class="sd">        Length of each segment used in scipy.welch</span>
<span class="sd">        default = the Number of time points</span>
<span class="sd">    window : str or tuple or array_like, optional</span>
<span class="sd">        Desired window to use. See get_window for a list of windows</span>
<span class="sd">        and required parameters. If window is array_like it will be</span>
<span class="sd">        used directly as the window and its length will be used for</span>
<span class="sd">        nperseg.</span>
<span class="sd">        default = &quot;hann&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    freqs : ndarray</span>
<span class="sd">            Array containing the frequencies at which the PSD has been</span>
<span class="sd">            calculated</span>
<span class="sd">    PSD : ndarray</span>
<span class="sd">            Array containing the value of the PSD at the corresponding</span>
<span class="sd">            frequency value in V**2/Hz</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NPerSegment</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span>
        <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NPerSegment</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e5</span><span class="p">:</span>
            <span class="n">NPerSegment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="n">e5</span><span class="p">)</span>
    <span class="n">freqs</span><span class="p">,</span> <span class="n">PSD</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">SampleFreq</span><span class="p">,</span>
                                    <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">NPerSegment</span><span class="p">)</span>
    <span class="n">PSD</span> <span class="o">=</span> <span class="n">PSD</span><span class="p">[</span><span class="n">freqs</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    <span class="n">freqs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">PSD</span></div>


<span class="k">def</span> <span class="nf">_GetRealImagArray</span><span class="p">(</span><span class="n">Array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the real and imaginary components of each element in an array and returns them in 2 resulting arrays.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Array : ndarray</span>
<span class="sd">        Input array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    RealArray : ndarray</span>
<span class="sd">        The real components of the input array</span>
<span class="sd">    ImagArray : ndarray</span>
<span class="sd">        The imaginary components of the input array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ImagArray</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">num</span><span class="o">.</span><span class="n">imag</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">Array</span><span class="p">])</span>
    <span class="n">RealArray</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">num</span><span class="o">.</span><span class="n">real</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">Array</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">RealArray</span><span class="p">,</span> <span class="n">ImagArray</span>


<span class="k">def</span> <span class="nf">_GetComplexConjugateArray</span><span class="p">(</span><span class="n">Array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the complex conjugate of each element in an array and returns the resulting array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Array : ndarray</span>
<span class="sd">        Input array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ConjArray : ndarray</span>
<span class="sd">        The complex conjugate of the input array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ConjArray</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">num</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">Array</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ConjArray</span>


<div class="viewcode-block" id="fm_discriminator"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.fm_discriminator">[docs]</a><span class="k">def</span> <span class="nf">fm_discriminator</span><span class="p">(</span><span class="n">Signal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the digital FM discriminator from a real-valued time signal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Signal : array-like</span>
<span class="sd">        A real-valued time signal</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fmDiscriminator : array-like</span>
<span class="sd">        The digital FM discriminator of the argument signal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S_analytic</span> <span class="o">=</span> <span class="n">_hilbert</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">S_analytic_star</span> <span class="o">=</span> <span class="n">_GetComplexConjugateArray</span><span class="p">(</span><span class="n">S_analytic</span><span class="p">)</span>
    <span class="n">S_analytic_hat</span> <span class="o">=</span> <span class="n">S_analytic</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">S_analytic_star</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">_GetRealImagArray</span><span class="p">(</span><span class="n">S_analytic_hat</span><span class="p">)</span>
    <span class="n">fmDiscriminator</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fmDiscriminator</span></div>


<span class="k">def</span> <span class="nf">_approx_equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns if b is approximately equal to be a within a certain percentage tolerance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : float</span>
<span class="sd">        first value</span>
<span class="sd">    b : float</span>
<span class="sd">        second value</span>
<span class="sd">    tol : float</span>
<span class="sd">        tolerance in percentage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="n">tol</span>


<span class="k">def</span> <span class="nf">_is_this_a_collision</span><span class="p">(</span><span class="n">ArgList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects if a particular point is during collision after effect (i.e. a phase shift) or not.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ArgList : array_like</span>
<span class="sd">        Contains the following elements:</span>
<span class="sd">            value : float</span>
<span class="sd">                value of the FM discriminator</span>
<span class="sd">            mean_fmd : float</span>
<span class="sd">                the mean value of the FM discriminator</span>
<span class="sd">            tolerance : float</span>
<span class="sd">                The tolerance in percentage that it must be away from the mean value for it</span>
<span class="sd">                to be counted as a collision event.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    is_this_a_collision : bool</span>
<span class="sd">        True if this is a collision event, false if not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">,</span> <span class="n">mean_fmd</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="n">ArgList</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_approx_equal</span><span class="p">(</span><span class="n">mean_fmd</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="find_collisions"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.find_collisions">[docs]</a><span class="k">def</span> <span class="nf">find_collisions</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds collision events in the signal from the shift in phase of the signal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Signal : array_like</span>
<span class="sd">        Array containing the values of the signal of interest containing a single frequency.</span>
<span class="sd">    tolerance : float</span>
<span class="sd">        Percentage tolerance, if the value of the FM Discriminator varies from the mean by this</span>
<span class="sd">        percentage it is counted as being during a collision event (or the aftermath of an event).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Collisions : ndarray</span>
<span class="sd">        Array of booleans, true if during a collision event, false otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmd</span> <span class="o">=</span> <span class="n">fm_discriminator</span><span class="p">(</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">mean_fmd</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fmd</span><span class="p">)</span>

    <span class="n">Collisions</span> <span class="o">=</span> <span class="p">[</span><span class="n">_is_this_a_collision</span><span class="p">(</span>
        <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="n">mean_fmd</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">])</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fmd</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Collisions</span></div>


<div class="viewcode-block" id="count_collisions"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.count_collisions">[docs]</a><span class="k">def</span> <span class="nf">count_collisions</span><span class="p">(</span><span class="n">Collisions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counts the number of unique collisions and gets the collision index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Collisions : array_like</span>
<span class="sd">        Array of booleans, containing true if during a collision event, false otherwise.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CollisionCount : int</span>
<span class="sd">        Number of unique collisions</span>
<span class="sd">    CollisionIndicies : list</span>
<span class="sd">        Indicies of collision occurance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CollisionCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CollisionIndicies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lastval</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Collisions</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">lastval</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">CollisionIndicies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">CollisionCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">lastval</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">CollisionCount</span><span class="p">,</span> <span class="n">CollisionIndicies</span></div>


<div class="viewcode-block" id="parse_orgtable"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.parse_orgtable">[docs]</a><span class="k">def</span> <span class="nf">parse_orgtable</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse an org-table (input as a list of strings split by newline)</span>
<span class="sd">    into a Pandas data frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lines : string</span>
<span class="sd">        an org-table input as a list of strings split by newline</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        A data frame containing the org-table&#39;s data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">parseline</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">wi</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">wi</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">parseline</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">parseline</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;RunNo&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataframe</span></div>


<div class="viewcode-block" id="PressureData"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.PressureData">[docs]</a><span class="k">class</span> <span class="nc">PressureData</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for reading in pressure data from org-mode tables.</span>

<span class="sd">    The table must containing columns the following headings </span>
<span class="sd">    formatted as in the example below:</span>

<span class="sd">    | RunNo | Pressure (mbar) |</span>
<span class="sd">    |   1   |     1.35E-2        |</span>

<span class="sd">    In this case the run number would be 1 and the pressure would</span>
<span class="sd">    be 1.35E-2 mbar (0.00135 mbar).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the org-mode table file, reads the file in as a string,</span>
<span class="sd">        and runs parse_orgtable in order to read the pressure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">fileContents</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PressureData</span> <span class="o">=</span> <span class="n">parse_orgtable</span><span class="p">(</span><span class="n">fileContents</span><span class="p">)</span>

<div class="viewcode-block" id="PressureData.get_pressure"><a class="viewcode-back" href="../../datahandling.html#datahandling.datahandling.PressureData.get_pressure">[docs]</a>    <span class="k">def</span> <span class="nf">get_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RunNo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retreives the pressure value (in mbar) associated </span>
<span class="sd">        with a particular run number.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        RunNo : int</span>
<span class="sd">            The run number for which to retreive the pressure value</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pressure : float</span>
<span class="sd">            The pressure (in mbar) for this run number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Pressure</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PressureData</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">PressureData</span><span class="o">.</span><span class="n">RunNo</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">RunNo</span><span class="p">)][</span><span class="s1">&#39;Pressure (mbar)&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Pressure</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Ashley Setter.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>